---
layout: default
title: SimpleFIN Protocol
link_title: Protocol
last_modified: 2015-06-29
proto_version: "1.0-draft.2"
page_classes: protocol
---

Last updated: {{ page.last_modified }}

Version: {{ page.proto_version }}

The SimpleFIN standard defines:

1. [SimpleFIN HTTP protocol](#simplefin-http-protocol)
2. [SimpleFIN data format](#simplefin-data-format)
3. [Recommendations for token management](#recommendations)


# SimpleFIN HTTP Protocol #

## Players ##

Institution
:   This is a bank or other institution that people have accounts with.


SimpleFIN Server
:   An HTTP server operated by the Institution.  The SimpleFIN Server **must** require SSL for all communication with both the Account Holder and the Consumer.  Connection attempts not over SSL must be dropped -- they **must not** be redirected to SSL.


Account Holder
:   This is a person (or business) that has an account with the Institution.

Consumer
:   A Consumer is an application that connects to a SimpleFIN Server to retrieve financial information pertaining to an Account Holder.  The Consumer may be a hosted service or a locally-run application.  The Consumer **only** has read access to the SimpleFIN Server.  The Consumer **can not** alter the financial data on the SimpleFIN Server in any way.


## Overview ##

1. A [Consumer](#consumer) directs an [Account Holder](#account-holder) to a [SimpleFIN Server](#simplefin-server) to obtain a [Setup Token](#setup-token).

2. The [Account Holder](#account-holder) exchanges their [Institution](#institution) credentials for a newly-generated [Setup Token](#setup-token).

3. The [Account Holder](#account-holder) gives the [Setup Token](#setup-token) to the [Consumer](#consumer).

4. The [Consumer](#consumer) gives the [Setup Token](#setup-token) to the [SimpleFIN Server](#simplefin-server) and receives an [Auth Bundle](#auth-bundle).

5. The [Consumer](#consumer) uses the [Auth Bundle](#auth-bundle) to generate a short-lived [Access JWT](#access-jwt).

6. The [Consumer](#consumer) gets financial data from the [SimpleFIN Server](#simplefin-server) using the [Access JWT](#access-jwt).

Steps 5 and 6 are repeated as needed by the [Consumer](#consumer).


## URLS ##

The SimpleFIN Server chooses a Root Consumer URL.  The SimpleFin Server must then implement the following standard endpoints as child resources to the Root Consumer URL:


### GET /info ###

This returns a JSON document with this information:

- `versions` - An array of strings indicating the versions supported by this server.


#### Authentication

None required.


#### Success response ####

{% highlight json %}
{
  "versions": ["{{ page.proto_version }}"]
}
{% endhighlight %}


### POST /auth/&lt;token&gt; ###

Consumers use this endpoint to claim access by exchanging a [Setup Token](#setup-token) for an [Auth Bundle](#auth-bundle).  SimpleFIN Server's **must** only successfully respond to this endpoint for a given `token` once.

#### Authentication

No authentication is required beyond the `token` embedded in the URL.

#### Response codes and content

- `200` - A successful response will be a JSON-encoded [Auth Bundle](#auth-bundle).
- `403` - Forbidden when an attempt to reuse a `token` is used or when a non-issued `token` is used.


### GET /create ###

Requests to this endpoint must return a web page that will allow Account Holders to create new Setup Tokens.  The specifics are left up to the SimpleFIN Server.

#### Authentication

No SimpleFIN authentication is required.  Account Holders **should** be prompted for their Institution credentials prior to creating any Setup Tokens.





### GET /accounts ###

Get an Account Holder's transaction data.

#### Query parameters

- `start-date` - (optional) if given, transactions will be restricted to those on or after this Unix epoch timestamp.
- `end-date` - (optional) if given, transactions will be retricted to those before (**but not on**) this Unix epoch timestamp

#### Authentication

Access to this resource requires an [Access JWT](#access-jwt) to be sent in the `Authentication` HTTP header like this:

{% highlight text %}
Authentication: X-JWT <the Access JWT>
{% endhighlight %}

#### Response codes and content ####

- `200` - A successful response will be a JSON-encoded [Account Set](#account-set).
- `403` - Authentication failed.








## Authentication Pieces ##

### Setup Token ###

A Setup Token is generated by the SimpleFIN Server and delivered to a Consumer by the Account Holder (via copy and paste).  It is a Base64-encoded URL of this form:

{% highlight text %}
<base_url>/auth/<setup_key>
{% endhighlight %}

Where

- `base_url` is the SimpleFIN Server's Root Consumer URL
- `setup_key` is a 32+ character, random string that the Consumer will provide in exchange for permanent credentials.

For instance, this URL:

{% highlight text %}
https://simplefin.example.com/auth/6e71a22a6ce9458b9897242423734d9c
{% endhighlight %}

would be encoded into a Setup Token like this:

{% highlight text %}
aHR0cHM6Ly9zaW1wbGVmaW4uZXhhbXBsZS5jb20vYXV0aC82ZTcxYTIyYTZjZTk0NThiOTg5NzI0
MjQyMzczNGQ5Yw==
{% endhighlight %}


### Auth Bundle ###

A Consumer exchanges a Setup Token for an Auth Bundle by issuing an HTTP POST request to the URL encoded in the Setup Token.  The SimpleFIN Server will respond to the POST request with a JSON body with the following attributes:

- `secret` - a PEM RSA private key suitable for signing JWT messages with the RS256 algorithm.
- `id` - a random string used to identify a user on the SimpleFIN Server.
- `url` - the Root Consumer URL for this SimpleFIN Server

For example:

{% highlight json %}
{
  "secret": "-----BEGIN RSA PRIVATE KEY-----\nMIICXQIBAAKBgQDLXMiGX65rxBDppslwqO/tsavi5pgSyQlopTGmVxiG+pAjXYLM\n44szNLnmc70IxmzUkY89YCGDxRRpqGjaMIb+Zilxkc7JA3i5VqHDZrzNFsv7GREO\n01Rp3oPihGFXOnLI+/YtRODksoqdqCFIC4uusP1TVSKsLGmI3HogCvn1ewIDAQAB\nAoGBALkl0T9dz3w39rnzasUSWdbLgtXC4cOAmvtWIxzxgNgrOZ2pHlQR+oL1RydE\nSl+54A2sNIBJjFnezVXgyQ2VTuCfnVMEyuk4i+Cl7BLArAMXTWbVggJOHtdGLzjp\nm1LrQA07exdCJop5GN5zca8qFZc9IOILdCDVh1UxciBBHB1ZAkEAz1o+OOq/nTH9\nwdTm/UMdxgCvIPYB7cWVmdEtZ+Ezs5yAVMrj7itUxW00wJBfMbIOQI9JwYTU1dcv\nDprLlnxu5wJBAPsS5J3PHKueXFMsnO1IvXSm3riZQoklCYJAXr2NHX8Bzem51IZs\nrEIAI0XlXFoGYRq1t7rh3Y+TA0HyFKD9Vk0CQQCxFv21Vqg39Q4okVCGVOAEz2jC\n2dhj3jAaopAI/ElPyQXBZVatfsxzoQVAwQzMQKnzcW0one24hINoEcR2zedZAkBu\nYCjnA2T8QXsfCY7XddHsFWv2RVINzp12iGvd8sqTyixG4u3+RooX3c2j7agC36kS\nv+5Mlvz7IEsfU5gkChtFAkB1H5kvS60oYAesdC+8MAzcNfH+nm0AOCiWoii7nXxe\nYw9fW79bQSvtnhL8gsrNrUCIfXQ9JFFzlrRS7ZCE+i0o\n-----END RSA PRIVATE KEY-----",
  "id": "6e71a22a6ce9458b9897242423734d9c",
  "url": "https://simplefin.example.com"
}
{% endhighlight %}

The SimpleFIN Server **must only** respond to this request once for a given `setup_key`.  Future POSTs with the same `setup_key` **must** return 403 Forbidden.


### Access JWT ###

A Consumer generates an access JWT using the Auth Bundle `secret` to sign a message containing the Auth Bundle `id` and some timestamps.  The JWT body **must** contain the following:

- `id` - the Auth Bundle `id`
- `exp` - a Unix epoch timestamp indicating when this token expires.  It **must** be within 60 seconds after `nbf`.
- `nbf` - a Unix epoch timestamp before which this token is not valid.  It **must** be within 60 seconds before `exp`.

For example, using the `id` from above:

{% highlight json %}
{
  "id": "6e71a22a6ce9458b9897242423734d9c",
  "nbf": 1435724162,
  "exp": 1435724222
}
{% endhighlight %}

would be signed as the following JWT (using the `secret` from above):

{% highlight text %}
eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjZlNzFhMjJhNmNlOTQ1OGI5ODk3MjQyNDIzNzM0ZDljIiwiZXhwIjoxNDM1NzI0MjIyLCJuYmYiOjE0MzU3MjQxNjJ9.DIG7Mu1bhRtw96aMbLVNF0xkGpQLpLA66rSOZBvWS9Tov0400ajMlVwrMnzn46LfTZoPPUuTXGK3eJxQuHDsNViSasThOUUNC8v-Pbql63howI49_t1E99WW7bOhTvJ1Zb87atFiz1id6TK_IX0fnqC9ZJRzgyWwf8v0okPmhhg
{% endhighlight %}

This Access JWT is used to authenticate a Consumer to a SimpleFIN Server as described above in [`GET /accounts`](#get-accounts)






# SimpleFIN Data Format #

- Data is encoded as JSON strings.
- All attributes are required unless otherwise noted.

These objects are defined by SimpleFIN (more details below):

- [Organization](#organization)
- [Account](#account)
- [Transaction](#transaction)
- [Account Set](#account-set)


## Organization ##

{% highlight json %}
{
  "domain": "mybank.com",
  "sfin-url": "https://sfin.mybank.com"
}
{% endhighlight %}

{% for attr in site.data.sfindata.organization.attributes %}
`{{ attr.name }}`
:   *{{ attr.type }}*
    
    {% if attr.optional %}(OPTIONAL) {% endif %}
    {{ attr.description }}
    {% for example in attr.examples %}
    - `{{ example }}`
    {% endfor %}

{% endfor %}



## Account ##

{% highlight json %}
{
  "org": {
    "domain": "mybank.com",
    "sfin-url": "https://sfin.mybank.com"
  },
  "id": "2930002",
  "name": "Savings",
  "currency": "USD",
  "balance": "100.23",
  "available-balance": "75.23",
  "balance-date": "2001-01-01T09:22:33.2343",
  "transactions": [
    {
      "id": "AO334",
      "posted": "1995-02-17T23:56:12.22239",
      "amount": "-33293.43",
      "description": "Uncle Frank's Bait Shop",
    }
  ]
}
{% endhighlight %}

{% for attr in site.data.sfindata.account.attributes %}
`{{ attr.name }}`
:   *{{ attr.type }}*
    
    {% if attr.optional %}(OPTIONAL) {% endif %}
    {{ attr.description }}
    {% for example in attr.examples %}
    - `{{ example }}`
    {% endfor %}

{% endfor %}



## Transaction ##
{% highlight json %}
{
  "id": "12394832938403",
  "posted": 793090572,
  "amount": "-33293.43",
  "description": "Uncle Frank's Bait Shop",
}
{% endhighlight %}

{% for attr in site.data.sfindata.transaction.attributes %}
`{{ attr.name }}`
:   *{{ attr.type }}*
    
    {% if attr.optional %}(OPTIONAL) {% endif %}
    {{ attr.description }}
    {% for example in attr.examples %}
    - `{{ example }}`
    {% endfor %}

{% endfor %}


## Account Set ##
{% highlight json %}
{
  "accounts": [
    {
      "org": {
        "domain": "mybank.com",
        "sfin-url": "https://sfin.mybank.com"
      },
      "id": "2930002",
      "name": "Savings",
      "currency": "USD",
      "balance": "100.23",
      "available-balance": "75.23",
      "balance-date": 978366153,
      "transactions": []
    }
  ]
}
{% endhighlight %}

{% for attr in site.data.sfindata.accountset.attributes %}
`{{ attr.name }}`
:   *{{ attr.type }}*
    
    {% if attr.optional %}(OPTIONAL) {% endif %}
    {{ attr.description }}
    {% for example in attr.examples %}
    - `{{ example }}`
    {% endfor %}

{% endfor %}


# Recommendations #

It is *recommended* that Account Holders have the following abilities regarding Access Token management:

1. Users can associate user-provided names with tokens (e.g. "This is the token being used by example.com").
2. Users can create many tokens (for providing to multiple third party services).
3. Users can choose an expiration date for tokens when creating them.
4. Users can manually invalidate/expire existing tokens at will.  This is useful in the case of stolen tokens or abuse by third parties to whom tokens were given.

Additionally, consider the following when implementing a token management system:

1. It may be nice to notify users prior to token expiration.
2. It may be nice to allow users to temporarily disable all tokens and later re-enable them.  This can be used to prevent access while doing research into abuse.
3. Consider providing logging/audit information regarding token use, including the time tokens were used and the IPs from which requests came.
4. Allow tokens to be associated with a subset of available accounts.  For instance, allow the user to create one token for access to just their checking account, and another token for access to just their savings account.


<script src="/js/anchor.min.js"></script>
<script>
/**
 * AnchorJS v1.1.1 options and selector
 */

(function () {
  'use strict';

  anchors.options.placement = 'right';

  anchors.add('h1, h2, h3, h4, h5, h6, dt');

})();
</script>
